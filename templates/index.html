
{% extends "layout.html" %}
{% block title %}Main{% endblock %}
{% block content %}
<div class="">
    <img src="{{ url_for('video_feed') }}" height="427px" width="582px">
</div>
<div class="md:flex gap-x-6">
    <div class="mt-1 flex flex-col items-center" style="font-size: 0px;">
        <div class="">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-camera" viewBox="0 0 16 12"> <path d="M15 12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h1.172a3 3 0 0 0 2.12-.879l.83-.828A1 1 0 0 1 6.827 3h2.344a1 1 0 0 1 .707.293l.828.828A3 3 0 0 0 12.828 5H14a1 1 0 0 1 1 1v6zM2 4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-1.172a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 9.172 2H6.828a2 2 0 0 0-1.414.586l-.828.828A2 2 0 0 1 3.172 4H2z"/> <path d="M8 11a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5zm0 1a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7zM3 6.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0z"/> </svg> 
        </div>
        <div class="">
            <label class="text-sm font-medium text-slate-700">Camara</label>
        </div>
        <div class="mt-1">
            <button class="bg-purple-300 hover:bg-purple-400 cursor-pointer px-5 py-2 text-sm leading-5 rounded-md font-semibold text-purple-100 shadow-sm" id="cUp">ðŸ¡…</button>
        </div>
        <div class="mt-1">
            <button class="bg-purple-300 hover:bg-purple-400 cursor-pointer px-5 py-2 text-sm leading-5 rounded-md font-semibold text-purple-100 shadow-sm" id="cLeft">ðŸ¡„</button>
            <button class="mx-1 bg-purple-300 hover:bg-purple-400 cursor-pointer px-5 py-2 text-sm leading-5 rounded-md font-semibold text-purple-100 shadow-sm" id="cDown">ðŸ¡‡</button>
            <button class="bg-purple-300 hover:bg-purple-400 cursor-pointer px-5 py-2 text-sm leading-5 rounded-md font-semibold text-purple-100 shadow-sm" id="cRight">ðŸ¡‡</button>
        </div>
    </div>
    
    <div class="mt-1 flex flex-col items-center" style="font-size: 0px;">
        <div class="">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-minecart" viewBox="0 0 16 16"> <path d="M4 15a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm0 1a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm8-1a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm0 1a2 2 0 1 0 0-4 2 2 0 0 0 0 4zM.115 3.18A.5.5 0 0 1 .5 3h15a.5.5 0 0 1 .491.592l-1.5 8A.5.5 0 0 1 14 12H2a.5.5 0 0 1-.491-.408l-1.5-8a.5.5 0 0 1 .106-.411zm.987.82 1.313 7h11.17l1.313-7H1.102z"/> </svg> 
        </div>

        <div class="">
            <label class="text-sm font-medium text-slate-700">Movimiento</label>
        </div>
        
        <div class="mt-1">
            <button class="bg-purple-300 hover:bg-purple-400 cursor-pointer px-5 py-2 text-sm leading-5 rounded-md font-semibold text-purple-100 shadow-sm" id="mUp">ðŸ¡…</button>
        </div>
        <div class="mt-1">
            <button class="bg-purple-300 hover:bg-purple-400 cursor-pointer px-5 py-2 text-sm leading-5 rounded-md font-semibold text-purple-100 shadow-sm" id="mLeft">ðŸ¡„</button>
            <button class="mx-1 bg-purple-300 hover:bg-purple-400 cursor-pointer px-5 py-2 text-sm leading-5 rounded-md font-semibold text-purple-100 shadow-sm" id="mDown">ðŸ¡‡</button>
            <button class="bg-purple-300 hover:bg-purple-400 cursor-pointer px-5 py-2 text-sm leading-5 rounded-md font-semibold text-purple-100 shadow-sm" id="mRight">ðŸ¡†</button>
        </div>
    </div>
</div>

<div class="mt-1"> 
    <svg fill="#000000" width="32px" height="32px" viewBox="0 0 32 32" id="icon" xmlns="http://www.w3.org/2000/svg"><defs><style>.cls-1{fill:none;}</style></defs><title>brightness-contrast</title><rect x="15" y="2" width="2" height="3"/><rect x="27" y="15" width="3" height="2"/><rect x="15" y="27" width="2" height="3"/><rect x="2" y="15" width="3" height="2"/><rect x="6.22" y="5.73" width="2" height="3" transform="translate(-3 7.23) rotate(-45)"/><rect x="23.27" y="6.23" width="3" height="2" transform="translate(2.14 19.63) rotate(-45)"/><rect x="23.77" y="23.27" width="2" height="3" transform="translate(-10.26 24.77) rotate(-45)"/><polygon points="5.47 25.13 7.59 23 9 24.42 6.88 26.54 5.47 25.13"/><path d="M16,8a8,8,0,1,0,8,8A8,8,0,0,0,16,8Zm0,14a6,6,0,0,1,0-12Z"/><rect id="_Transparent_Rectangle_" data-name="&lt;Transparent Rectangle&gt;" class="cls-1" width="32" height="32"/></svg>
</div>

<div class="flex gap-x-3">
    
    <div class="mt-1 flex flex-col items-center" style="font-size: 0px;">
        <div class="">
            <label class="text-sm font-medium text-slate-700">Brillo</label>
        </div>
        <div class="mt-1">
            <button class="bg-purple-300 hover:bg-purple-400 cursor-pointer px-5 py-2 text-sm leading-5 rounded-md font-semibold text-purple-100 shadow-sm" id="bUp">ðŸ¡…</button>
        </div>
        <div class="mt-1">
            <button class="mx-1 bg-purple-300 hover:bg-purple-400 cursor-pointer px-5 py-2 text-sm leading-5 rounded-md font-semibold text-purple-100 shadow-sm" id="bDown">ðŸ¡‡</button>
        </div>
    </div>
    
    <div class="mt-1 flex flex-col items-center" style="font-size: 0px;">
        
        <div class="">
            <label class="text-sm font-medium text-slate-700">Contraste</label>
        </div>
        
        <div class="mt-1">
            <button class="bg-purple-300 hover:bg-purple-400 cursor-pointer px-5 py-2 text-sm leading-5 rounded-md font-semibold text-purple-100 shadow-sm" id="cnUp">ðŸ¡…</button>
        </div>
        <div class="mt-1">
            <button class="mx-1 bg-purple-300 hover:bg-purple-400 cursor-pointer px-5 py-2 text-sm leading-5 rounded-md font-semibold text-purple-100 shadow-sm" id="cnDown">ðŸ¡‡</button>
        </div>
    </div>
</div>
<div class="mt-1"> 
    <button class="mx-1 bg-purple-300 hover:bg-purple-400 cursor-pointer px-5 py-2 text-sm leading-5 rounded-md font-semibold text-purple-100 shadow-sm" id="reset">RESET</button>
</div>



<div class="mt-4 flex flex-col items-center">
    <div>
        <label class="block text-sm font-medium text-slate-700">Tareas</label>
    </div>
    <div>
        <button class="bg-purple-300 hover:bg-purple-400 cursor-pointer px-5 py-2 text-sm leading-5 rounded-md font-semibold text-purple-100 shadow-sm" id="tRoam">ROAM</button>
        <button class="bg-purple-300 hover:bg-purple-400 cursor-pointer px-5 py-2 text-sm leading-5 rounded-md font-semibold text-purple-100 shadow-sm" id="tRec">REC</button>
        <button class="bg-purple-300 hover:bg-purple-400 cursor-pointer px-5 py-2 text-sm leading-5 rounded-md font-semibold text-purple-100 shadow-sm" id="tNone">NONE</button>
    </div>
    <div class="mt-4">
        <label class="block text-sm font-medium text-slate-700 shadow-sm">Captura</label>
    </div>
</div>

    <div>
        <input id="name" type="text" class="text-sm px-2 py-2 bg-white border shadow-sm border-slate-300 placeholder-slate-400 rounded-md focus:outline-none focus:border-purple-400 focus:ring-purple-400">
        <button class="bg-purple-300 hover:bg-purple-400 cursor-pointer px-5 py-2 text-sm leading-5 rounded-md font-semibold text-purple-100 shadow-sm" id="imgCapture">Captura</button>
    </div>

    <div class="mx-4 mt-2 flex flex-col items-center">
        <label class="block text-sm font-medium text-slate-700">Eventos</label>
        <table class="mt-1 border-collapse rounded-md border border-slate-400 bg-white text-xs text-sm shadow-sm">
            <tr>
                <th class="border border-slate-300 font-semibold p-3.5 text-slate-900 text-center" scope="col">#</th>
                <th class="border border-slate-300 font-semibold p-3.5 text-slate-900 text-center" scope="col">Tipo</th>
                <th class="border border-slate-300 font-semibold p-3.5 text-slate-900 text-center" scope="col">Salon</th>
                <th class="border border-slate-300 font-semibold p-3.5 text-slate-900 text-center" scope="col">Maestro</th>
                <th class="border border-slate-300 font-semibold p-3.5 text-slate-900 text-center" scope="col">Tiempo</th>
            </tr>
            <tbody id="tbody">
            {% for event in events %}
                <tr>
                    <td class="border border-slate-300 p-3.5 text-slate-500" >{{ event['id'] }}</td>
                    <td class="border border-slate-300 p-3.5 text-slate-500">{{ event['Tipo'] }}</td>
                    <td class="border border-slate-300 p-3.5 text-slate-500">{{ event['salon_nombre'] }}</td>
                    {% if event['maestro_nombre'] is not none %}   
                    <td class="border border-slate-300 p-3.5 text-slate-500">{{ event['maestro_nombre'] }}</td>
                    {% else %}
                    <td class="border border-slate-300 p-3.5 text-slate-500">Ninguno</td>
                    {% endif %}
                    <td class="border border-slate-300 p-3.5 text-slate-500">{{ event['Tiempo'] }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

</div>
{% endblock %}

{% block script %}
<script>

    const socket = io();

    function addRow(id, tipo, salon, maestro, tiempo) {
        if (maestro == undefined) {
            maestro = "Ninguno"
        }

        $("#tbody").append(`
        <tr> 
            <td class="border border-slate-300 p-3.5 text-slate-500">${id}</td>
            <td class="border border-slate-300 p-3.5 text-slate-500">${tipo}</td>
            <td class="border border-slate-300 p-3.5 text-slate-500">${salon}</td>
            <td class="border border-slate-300 p-3.5 text-slate-500">${maestro}</td>
            <td class="border border-slate-300 p-3.5 text-slate-500">${tiempo}</td>
        </tr>`);
    }

    $("#imgCapture").click(function () {
	socket.emit('capture', $("#name").val());
    })

    $("#cUp").click('click', function () {
        console.log("+y");
        socket.emit("servo", "+y");
    })
    $("#cDown").click(function () {
        console.log("-y");
        socket.emit("servo", "-y");
    })
    $("#cLeft").click(function () {
        console.log("+x");
        socket.emit("servo", "+x");
    })

    $("#cRight").click(function () {
        console.log("-x");
        socket.emit("servo", "-x");
    })

    $("#mUp").bind("mousedown pointerdown", function () {
        console.log("forward");
        socket.emit("motor", "f");
    })
    $("#mDown").bind("mousedown pointerdown", function () {
        console.log("back");
        socket.emit("motor", "b");
    })
    $("#mLeft").bind("mousedown pointerdown", function () {
        console.log("left");
        socket.emit("motor", "l");
    })
    $("#mRight").bind("mousedown pointerdown", function () {
        console.log("right");
        socket.emit("motor", "r");
    })

    $("#mUp, #mDown, #mLeft, #mRight").bind("mouseup pointerout touchend click", function () {
        socket.emit("motor", "s");
    })

    $("#tRoam").click(function () {
        console.log("task: roam");
        socket.emit("set_task", "roam");
    })
    $("#tRec").click(function () {
        console.log("task: recognize");
        socket.emit("set_task", "recognize");
    })
    $("#tNone").click(function () {
        console.log("task: none");
        socket.emit("set_task", "none");
    })

    $("#bUp").click(function () {
        socket.emit("brightness", "+");
    })
    $("#bDown").click(function () {
        socket.emit("brightness", "-");
    })
    
    $("#cnUp").click(function () {
        socket.emit("contrast", "+");
    })
    $("#cnDown").click(function () {
        socket.emit("contrast", "-");
    })

    $("#reset").click(function () {
        socket.emit("reset");
    })
    socket.on("event", ({id, tipo, salon, maestro, tiempo}) => {
        addRow(id, tipo, salon, maestro, tiempo)
    });

</script>

{% endblock %}